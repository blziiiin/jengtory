<!DOCTYPE html>
<html lang="en">
    <head>
        <title>JengDle</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE-edge">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">

        <link rel="stylesheet" href="wordle.css">
    </head>
    <body>
        <h1 id="title">Equadle</h1>
        <hr>
        <br>
        <div id="board">

        </div>

        <br>
        <h1 id="answer"></h1>
        
        <br>
        <div id="keypad">

        </div>
        
<!--        키패드 만들기-->
        <input id="0" type="button" class="pad" value="0" onclick="fillBox(0)"/>
        <input id="1" type="button" class="pad" value="1" onclick="fillBox(1)"/>
        <input id="2" type="button" class="pad" value="2" onclick="fillBox(2)"/>
        <input id="3" type="button" class="pad" value="3" onclick="fillBox(3)"/>
        <input id="4" type="button" class="pad" value="4" onclick="fillBox(4)"/>
        <input id="5" type="button" class="pad" value="5" onclick="fillBox(5)"/>
        <input id="6" type="button" class="pad" value="6" onclick="fillBox(6)"/>
        <input id="7" type="button" class="pad" value="7" onclick="fillBox(7)"/>
        <input id="8" type="button" class="pad" value="8" onclick="fillBox(8)"/>
        <input id="9" type="button" class="pad" value="9" onclick="fillBox(9)"/>
        <input id="+" type="button" class="pad" value="+" onclick="fillBox2(0)"/>
        <input id="-" type="button" class="pad" value="-" onclick="fillBox2(1)"/>
        <input id="×" type="button" class="pad" value="×" onclick="fillBox2(2)"/>
        <input id="÷" type="button" class="pad" value="÷" onclick="fillBox2(3)"/>
        <input id="=" type="button" class="pad" value="=" onclick="fillBox2(4)"/>
        <input id="b" type="button" class="longpad" value="Erase" onclick="erase()"/>
        <input id="e" type="button" class="longpad" value="Enter" onclick="enter()"/>

        <script>
            let height = 6; // 줄 갯수 
            let width = 6; // 단어 길이

            let row = 0; // 현재 줄 (attempt #)
            let col = 0; // 현재 알파벳 인덱스 

            let gameOver = false;
            let word = "2×9=18";
            
            window.onload = function() {
                for (let i=0; i<10; i++) {
                    document.getElementById("keypad").appendChild(document.getElementById(i.toString()));
                }
                for (let i=0; i<5; i++) {
                    document.getElementById("keypad").appendChild(document.getElementById("+-×÷="[i].toString()));
                }
                document.getElementById("keypad").appendChild(document.getElementById("b"));
                document.getElementById("keypad").appendChild(document.getElementById("e"));
                
                initialize();
            };
            
            function initialize() {
                // 보드 만들기
                for (let r = 0; r < height; r++) {
                    if (r === 0) {
                        // 첫 줄 예시로 채우기
                        for (let c = 0; c < width; c++) {
                            //<span id="0-0" class="tile"></span>
                            let tile = document.createElement("span"); 
                            tile.id = r.toString() + "-" + c.toString(); 
                            tile.classList.add("tile");
                            tile.innerText = "2+8=10"[c];
                            tile.classList.add("eg");
                            document.getElementById("board").appendChild(tile); 
                        }
                    }
                    else {
                        for (let c = 0; c < width; c++) {
                            //<span id="0-0" class="tile"></span>
                            let tile = document.createElement("span"); 
                            tile.id = r.toString() + "-" + c.toString(); 
                            tile.classList.add("tile");
                            tile.innerText = "";
                            document.getElementById("board").appendChild(tile); 
                        }
                    }
                    
                }
                row += 1;
            };
            
            function fillBox(w) {
                // 키패드를 누르면 실행되는 부분
                if(gameOver) return;
                if (col < width) {
                    let currTile = document.getElementById(row.toString() + "-" + col.toString());
                    if (currTile.innerText === "") {
                        currTile.innerText = w;
                        col += 1;
                    }
                    let target = document.getElementById(w.toString());
                    target.classList.add("disabled_pad");
                    target.disabled = true;
                }
            };
            
            function fillBox2(w) {
                // 키패드를 누르면 실행되는 부분
                if(gameOver) return;
                if (col < width) {
                    let currTile = document.getElementById(row.toString() + "-" + col.toString());
                    if (currTile.innerText === "") {
                        currTile.innerText = "+-×÷="[w];
                        col += 1;
                    }
                }
                if (w === 4) {
                    let target = document.getElementById("=");
                    target.classList.add("disabled_pad");
                    target.disabled = true;
                }
            };
            
            function erase() {
                // 키패드를 누르면 실행되는 부분
                if(gameOver) return;
                if (0 < col && col <= width) {
                    col -= 1;
                }
                let currTile = document.getElementById(row.toString() + '-' + col.toString());
                let w = currTile.innerText;
                if ("0123456789=".includes(w)) {
                    let target = document.getElementById(w);
                    target.classList.remove("disabled_pad");
                    target.disabled = false;
                }
                currTile.innerText = "";
            };
            
            function enter() {
                // 키패드를 누르면 실행되는 부분
                if(gameOver) return;
                if (col === width && validation()) {
                    update();
                    // 다시 모든 버튼 활성화
                    for (let i = 0; i<11; i++) {
                        let target = document.getElementById("0123456789="[i]);
                        target.classList.remove("disabled_pad");
                        target.disabled = false;
                    }
                    row += 1; // start new row
                    col = 0;  // start at 0 for new row
                }
                if (!gameOver && row === height) {
                    gameOver = true;
                    document.getElementById("answer").innerText = word;
                }
            };
            
            function update() {
                let correct = 0;
                for (let c = 0; c < width; c++) {
                    let currTile = document.getElementById(row.toString() + '-' + c.toString());
                    let letter = currTile.innerText;

                    // letter가 맞는 자리에 있는가?
                    if (word[c] === letter) {
                        currTile.classList.add("correct");
                        correct += 1;
                    } // letter가 정답에 존재하는가? 
                    else if (word.includes(letter)) {
                        currTile.classList.add("present");
                    } // letter 정답에 없음? 
                    else {
                        currTile.classList.add("absent");
                    }
                    // 정답을 맞추면 게임오버 
                    if (correct === width) {
                        gameOver = true;
                    }
                }
            };
            
            function validation() {
                // 수식이 유효한지 확인
                let letter = "";
                for (let c = 0; c < width; c++) {
                    let currTile = document.getElementById(row.toString() + '-' + c.toString());
                    letter += currTile.innerText;
                }
                // = 은 2~5번째 칸에 반드시 있어야 한다.
                let eq = letter.indexOf("=");
                if (eq <= 0 || eq >= 5) {
                    for (let c = 0; c < width; c++) {
                        let currTile = document.getElementById(row.toString() + '-' + c.toString());
                        currTile.classList.add("temp");
                    }
                    setTimeout(function(){
                        for (let c = 0; c < width; c++) {
                            let currTile = document.getElementById(row.toString() + '-' + c.toString());
                            currTile.classList.remove("temp");
                        }
                    }, 200);
                    return false;
                }
                // 왼쪽 식을 계산
                let left = 0;
                let temp_l = 0;
                let op_l = "=";
                for (let i = 0; i<eq; i++) {
                    if ("0123456789".includes(letter[i])) {
                        temp_l *= 10;
                        temp_l += parseInt(letter[i]);
                    }
                    else {
                        left = temp_l;
                        op_l = letter[i];
                        temp_l = 0;
                    }
                }
                switch(op_l) {
                    case "=": // just value
                        left = temp_l;
                        break;
                    case "+": // +
                        left += temp_l;
                        break;
                    case "-":
                        left -= temp_l;
                        break;
                    case "×":
                        left *= temp_l;
                        break;
                    case "÷":
                        left /= temp_l;
                        break;
                }
                // 오른쪽 식을 계산
                let right = 0;
                let temp_r = 0;
                let op_r = "=";
                for (let i =eq + 1; i<letter.length; i++) {
                    if ("0123456789".includes(letter[i])) {
                        temp_r *= 10;
                        temp_r += parseInt(letter[i]);
                    }
                    else {
                        right = temp_r;
                        op_r = letter[i];
                        temp_r = 0;
                    }
                }
                switch(op_r) {
                    case "=": // just value
                        right = temp_r;
                        break;
                    case "+": // +
                        right += temp_r;
                        break;
                    case "-":
                        right -= temp_r;
                        break;
                    case "×":
                        right *= temp_r;
                        break;
                    case "÷":
                        right /= temp_r;
                        break;
                }
                
                if (left === right) return true;
                // 틀렸다는 이펙트 표시
                for (let c = 0; c < width; c++) {
                    let currTile = document.getElementById(row.toString() + '-' + c.toString());
                    currTile.classList.add("temp");
                }
                setTimeout(function(){
                    for (let c = 0; c < width; c++) {
                        let currTile = document.getElementById(row.toString() + '-' + c.toString());
                        currTile.classList.remove("temp");
                    }
                }, 200);
                return false;
            }
        </script>
    </body>
</html>